// show a hand cursor on expand links
$(".expand-link").hover( function() { $(this).css("cursor", "pointer"); });
// make sublist visible on expand links click
$(".expand-link").click( function() { $(this).parent('li').parent('ul').parent('div').toggleClass("collapsible-list"); });
// restrict width of images on manual and command pages to fit besides TOC
$(".manualtoc").parent().find("img").css({"max-width":$(".manualtoc").parent().width()-300,"height":"auto"});
$(".fcinfobox").parent().find("img").css({"max-width":$(".fcinfobox").parent().width()-300,"height":"auto"});

mw.loader.using('mediawiki.util', function () {
    $(function () {
        var pageTitle = mw.config.get('wgPageName');
        

        if (/\/[a-z\-]{2,3}$/.test(pageTitle)) return;

        var fileName = pageTitle.replace(/:/g, ';');
        var githubUrl = 'https://github.com/Reqrefusion/FreeCAD-Documentation-Project/blob/main/wiki/' + fileName + '.wikitext';

        var after = document.getElementById('ca-edit') || document.getElementById('ca-viewsource');

        mw.util.addPortletLink(
            'p-views',
            githubUrl,
            'Edit on GitHub',
            'ca-editgithub',
            'Edit this page on GitHub'
        );

        var newLink = document.getElementById('ca-editgithub');
        if (after && newLink) {
            after.parentNode.insertBefore(newLink, after.nextSibling);
        }
    });
});


mw.loader.using('mediawiki.util').then(function () {
    mw.hook('wikipage.content').add(function () {
        var subtitle = document.getElementById('mw-content-subtitle');
        if (!subtitle || subtitle.querySelector('.mw-pt-translate-header')) return;

        var lang  = mw.config.get('wgPageContentLanguage') || mw.config.get('wgUserLanguage');
        var label = mw.message('pt-translate').inLanguage(lang).plain();

        var link = document.createElement('a');
        link.href = mw.util.getUrl('Special:PageTranslation', { target: mw.config.get('wgPageName') });
        link.textContent = label;

        var span = document.createElement('span');
        span.className = 'mw-pt-translate-header';
        span.style.display = 'block';
        span.style.textAlign = 'center';
        span.appendChild(link);

        subtitle.insertBefore(span, subtitle.firstChild);

        if (subtitle.querySelector('.approvedAndLatestMsg, .notLatestMsg')) {
            span.insertAdjacentHTML('afterend', '<br>');
        }
    });
});