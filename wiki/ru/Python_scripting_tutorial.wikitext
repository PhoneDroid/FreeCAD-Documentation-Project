<languages/>

{{Docnav/ru
|[[Introduction_to_Python/ru|Introduction to Python]]
|[[FreeCAD_Scripting_Basics/ru|FreeCAD Scripting Basics]]
}}

{{TOCright}}

<span id="Introduction"></span>
==Введение==

[https://ru.wikipedia.org/wiki/Python Python] - это язык программирования, относительно простой в изучении и понимании. Он является многоплатформенным  языком с открытым исходным кодом и может использоваться в разных целях: от программирования простых скриптов до очень сложных программ. Но он наиболее распространен как язык сценариев, внедряемых в другие приложения. Так он используется и внутри FreeCAD. Из [[Python_console/ru|консоли Python]] или с помощью собственных скриптов вы можете управлять FreeCAD, заставляя его выполнять очень сложные операции.

Например, из сценария Python вы можете:
* Создать новые объекты.
* Изменить существующие объекты.
* Изменить трехмерное представление этих объектов.
* Изменить интерфейс FreeCAD.

Существует несколько способов использования Python в FreeCAD:
* Из [[FreeCAD Scripting Basics/ru|Интерпретатора Python в FreeCAD]], где вы можете запускать простые команды, симулируя интерфейс командной строки
* Из [[macros/ru|макросов]], которые являются удобным способом быстрого добавления недостающего функционала в интерфейс FreeCAD
* Из внешних скриптов, которые можно использовать для создания довольно сложных решений, даже [[Workbenches/ru|верстаков]].

В этом руководстве мы рассмотрим несколько базовых примеров, которые помогут вам начать работу. В этой вики также имеется гораздо больше [[Power users hub/ru|документации по Python сценариям]]. Если вы абсолютный новичок в Python и хотите понять, как это работает, у нас есть базовый курс [[introduction to Python/ru|Введение в Python]].

<div class="mw-translate-fuzzy">
Перед написанием сценариев Python, перейдите в окно {{MenuCommand|Правка → Настройки → Основные → Просмотр отчёта}} и проверьте, отмечены ли два пункта:
* {{MenuCommand|Перенаправить внутренний вывод Python в отчет}}.
* {{MenuCommand|Перенаправить внутренние ошибки Python в отчет}}.
Затем перейдите в {{MenuCommand|Вид → Панели}} и отметьте:
*  {{MenuCommand|Отчет}}.
</div>

<span id="Writing_Python_code"></span>
==Написание кода Python==

Существует два простых способа написания кода Python в FreeCAD: в [[Python console/ru|консоли Python]] (выберите в меню {{MenuCommand|Вид → Панели → Консоль Python}}) или из [[Std_DlgMacroExecute/ru|редактора макросов]] (выберите в меню {{MenuCommand|Инструменты → Макросы}}). В консоли вы последовательно пишете python команды, которые выполняются при нажатии {{KEY|Enter}}. Макросы могут содержать более сложный многострочный код, который выполняется только во время запуска макроса.

[[Image:Screenshot_pythoninterpreter.jpg]]
{{Caption|Консоль Python в FreeCAD}}

В этом руководстве можно использовать оба метода. Можно копировать/вставлять по одной строчке в консоли Python и нажимать {{KEY|Enter}}, или копировать/вставлять весь код в новое окно макроса.
{{Top}}
<span id="Exploring_FreeCAD"></span>
== Изучение FreeCAD ==

Начнём с создания нового пустого документа:

{{Code|code=
doc = FreeCAD.newDocument()
}}

<div class="mw-translate-fuzzy">
Если Вы вводите это в консоли Python FreeCADа, то заметите, что как только Вы ввели {{incode|FreeCAD.}} (слово FreeCAD с последующей точкой), появится окно, позволяющее быстро автозаполнить продолжение строки. Даже лучше, каждый ввод в списке автодополнения содержит подсказку. Это облегчает раскрытие имеющейся функциональности. Перед выбором {{incode|newDocument}}, взгляните на другие доступные опции.
</div>

[[Image:Screenshot_classbrowser.jpg]]
{{Caption|Механизм автозаполнения python консоли FreeCAD}}

<div class="mw-translate-fuzzy">
Теперь наш новый документ будет создан. Это похоже на нажатие кнопки {{Button|[[Image:Std_New.svg|16px]] [[Std_New/ru|Std New]]}} на панели инструментов. Фактически, большинство кнопок в FreeCAD ничего не делают, кроме выполнения одной или нескольких строк кода Python. Даже лучше, вы можете установить параметр в {{MenuCommand|Правка → Настройки → Общее → Макрос}}, чтобы {{MenuCommand|показать команды сценария в консоли Python}}. Это будет выводить в консоль весь код Python, который выполняется при нажатии кнопок. Очень полезно, чтобы узнать, как воспроизводить действия в Python.
</div>

Теперь вернёмся назад в документ и посмотрим, что мы можем с ним сделать:

{{Code|code=
doc.
}}

Изучим доступные варианты. Обычно имена, начинающиеся с заглавной буквы, это атрибуты, они содержат значения, а имена с маленькой буквы являются функциями (называемые так же методами), они "что-то делают". Имена, начинающиеся с подчёркиваний, обычно используются для внутренних нужд модуля, и Вам не следует обращать на них внимание. Используем один из методов для добавления в документ нового объекта:

{{Code|code=
box = doc.addObject("Part::Box", "myBox")
}}

<div class="mw-translate-fuzzy">
Ничего не произошло. Почему? Потому что FreeCAD создан для больших проектов. Однажды он будет работать с сотнями сложных взаимосвязанных объектов. Возможно, что внесение небольшого изменения может иметь большое значение, вам может потребоваться пересчитать весь документ, что может занять много времени ... По этой причине почти никакая команда не обновляет сцену автоматически. Вы должны сделать это вручную:
</div>

{{Code|code=
doc.recompute()
}}

<div class="mw-translate-fuzzy">
Теперь наш куб появился в окне трёхмерного вида. Большинство кнопок панелей инструментов фактически делают две вещи: добавляют объект и выполняют пересчёт. Если Вы включите в настройках опцию {{MenuCommand|"Показывать команды скриптов в консоли python"}} и попробуете добавить сферу с соответствующей кнопкой, Вы увидите две строки Python кода, выполняемые одна за другой.
</div>

Теперь рассмотрим содержимое нашего куба:

{{Code|code=
box.
}}

Вы немедленно увидите несколько очень интересных вещей вроде этого:

{{Code|code=
box.Height
}}

Это покажет текущую высоту нашего куба. Теперь попробуем её изменить:

{{Code|code=
box.Height = 5
}}

<div class="mw-translate-fuzzy">
Если вы выберете куб с помощью мыши, вы увидите, что [[Property_editor/ru|Property editor]] на вкладке {{MenuCommand|Данные}} появится параметр {{PropertyData|Height}}. Все свойства объекта FreeCAD, которые появляются там (а также на вкладке {{MenuCommand|Вид}}, подробнее об этом позже), напрямую доступны также для Python по их именам, аналогично параметру {{PropertyData|Height}}. Попробуйте изменить другие размеры окна.
</div>
{{Top}}
<span id="Vectors_and_placements"></span>
==Вектора и размещение==

[https://ru.wikipedia.org/wiki/Вектор_(геометрия) Вектора] это самая основная концепция в любом трёхмерном приложении. Вектор это список трёх чисел (x, y и z), описывающих точку или позицию в трёхмерном пространстве. С векторами делаются многие вещи, такие как сложение, вычитание, проекции и [https://ru.wikipedia.org/wiki/Линейное_пространство многое другое]. В FreeCAD вектора работают примерно так:

{{Code|code=
myvec = FreeCAD.Vector(2, 0, 0)
myvec.x
myvec.y
othervec = FreeCAD.Vector(0, 3, 0)
sumvec = myvec.add(othervec)
}}

Еще одно имеющееся у всех объектов FreeCAD свойство - это его [[Placement/ru|размещение]]. Каждый объект имеет свойство {{PropertyData/ru|Placement}}, которое содержит {{PropertyData|Base}} (положение) и {{PropertyData|Rotation}} (ориентация) объекта. Это легко манипулировать, например, чтобы переместить наш объект:

{{Code|code=
box.Placement
box.Placement.Base
box.Placement.Base = sumvec
 
otherpla = FreeCAD.Placement()
box.Placement = otherpla
}}

Теперь вы должны понять пару важных понятий, прежде чем мы продолжим.
{{Top}}
<span id="App_and_Gui"></span>
==App и Gui==

FreeCAD был разработан так, чтобы его можно было использовать без пользовательского интерфейса, как приложение командной строки. Поэтому почти каждый объект в FreeCAD состоит из двух частей: {{incode|Object}}, компонент "геометрии", и {{incode|ViewObject}}, его "визуальная" компонента. При работе в режиме командной строки геометрическая часть имеется, но визуальная часть отключена.

Для иллюстрации концепции давайте посмотрим на наш объект куба. Геометрические свойства куба, такие как его размеры, положение и т.д., хранятся в {{incode|Object}}. А его визуальные свойства, такие как цвет, толщина линий и т.д., хранятся в {{incode|ViewObject}}. Это соответствует вкладкам «Данные» и «Вид» в [[Property_editor/ru|Редакторе свойств]]. Доступ к объекту вида осуществляется следующим образом:

{{Code|code=
vo = box.ViewObject
}}
Теперь вы также можете изменить свойства на вкладке «Вид»:

{{Code|code=
vo.Transparency = 80
vo.hide()
vo.show()
}}

Когда вы запускаете FreeCAD, консоль Python уже загрузила два базовых модуля: {{incode|FreeCAD}} и {{incode|FreeCADGui}}(которые также могут быть доступны по их ярлыкам {{incode|App}} и {{incode|Gui}}). Они содержат все виды общих функций для работы с документами и их объектами. Для иллюстрации нашей концепции, посмотрите, что и {{incode|FreeCAD}}, и {{incode|FreeCADGui}} содержат атрибут {{incode|ActiveDocument}}, который является текущим открытым документом. Однако {{incode|FreeCAD.ActiveDocument}} и {{incode|FreeCADGui.ActiveDocument}} это не один и тот же объект. Это два компонента документа FreeCAD, и содержат разные атрибуты и методы. Например, {{incode|FreeCADGui.ActiveDocument}} содержит {{incode|ActiveView}}, это текущий открытый [[3D_view/ru|трёхмерный вид]].
{{Top}}
<span id="Modules"></span>
==Модули==

<div class="mw-translate-fuzzy">
Истинная сила FreeCAD заключается в его верных модулях. Базовое приложение FreeCAD - это более или менее пустой контейнер. Без своих модулей он может сделать немного больше, чем создавать новые, пустые документы. Каждый модуль добавляет к интерфейсу не только новые верстаки, но и новые команды Python и новые типы объектов. В результате несколько разных и даже полностью несовместимых типов объектов могут сосуществовать в одном документе. Наиболее важные модули в FreeCAD, которые мы рассмотрим в этом руководстве, это: [[Part_Workbench/ru|Part]], [[Mesh_Workbench/ru|Mesh]], [[Sketcher_Workbench/ru|Sketcher]] и [[Draft_Workbench/ru|Draft]].
</div>

<div class="mw-translate-fuzzy">
Модули [[Sketcher_Workbench/ru|Sketcher]] и [[Draft_Workbench/ru|Draft]] используют модуль [[Part_Workbench/ru|Part]] для создания и поддержки их геометрии, в то время как модуль [[Mesh_Workbench/ru|Mesh]] полностью независим и поддерживает собственные объекты. Подробнее об этом ниже.
</div>

Вы можете проверить все доступные типы базовых объектов для текущего документа следующим образом:

{{Code|code=
doc.supportedTypes()
}}

Различные модули FreeCAD не загружаются в консоль Python автоматически. Это нужно для того, чтобы избежать замедленного запуска. Модули загружаются только тогда, когда они вам нужны. Поэтому для исследования того, что, например, находится внутри модуля Part:

{{Code|code=
import Part
Part.
}}

Но мы поговорим подробнее о модуле Part ниже.
{{Top}}
<span id="Mesh_module"></span>
<div class="mw-translate-fuzzy">
==Mesh==
</div>

[https://ru.wikipedia.org/wiki/Полигональная_сетка Сетки (meshes)] это весьма простой тип трёхмерных объектов, используемых, например, в [https://ru.wikipedia.org/wiki/SketchUp Sketchup], [https://ru.wikipedia.org/wiki/Blender Blender] и [https://ru.wikipedia.org/wiki/Autodesk_3ds_Max 3D Studio Max]. Они состоят из 3 элементов: точек (также называемых вершинами), линий (также называемых ребрами) и граней. Во многих приложениях, включая FreeCAD, грани могут иметь только 3 вершины. Разумеется, ничто не мешает использовать более крупные грани, состоящее из нескольких копланарных треугольников.

Сетки просты, и благодаря простоте их можно иметь миллионами в одном документе. Однако в FreeCAD они имеют меньшее использование, и в основном там, где надо импортировать объекты в форматах сетки ({{FileName|.stl}}, {{FileName|.obj}}) из других приложений. Модуль Mesh так же широко использовался в качестве основного тестового модуля в первые месяцы жизни FreeCAD.

Сеточные объекты и объекты FreeCAD - это разные вещи. Вы можете видеть объект FreeCAD как контейнер для объекта Mesh (и, как мы увидим ниже, также для объектов Part). Поэтому чтобы добавить объект сетки в FreeCAD, мы должны сначала создать объект FreeCAD и объект Mesh, а затем добавить объект Mesh в объект FreeCAD:

{{Code|code=
import Mesh
mymesh = Mesh.createSphere()
mymesh.Facets
mymesh.Points
 
meshobj = doc.addObject("Mesh::Feature", "MyMesh")
meshobj.Mesh = mymesh
doc.recompute()
}}

Это стандартный пример, который использует метод {{incode|createSphere()}} для создания сферы, но вы также можете создавать собственные сетки с нуля, определяя их вершины и грани.

[[Mesh Scripting/ru|Дальнейшее чтение о скриптах обработки сеток...]]
{{Top}}
<span id="Part_module"></span>
<div class="mw-translate-fuzzy">
==Part==
</div>

<div class="mw-translate-fuzzy">
[[Part_Workbench/ru|Модуль Part]] это самый мощный модуль во всём FreeCAD. Он позволяет создавать и управлять объектами [https://ru.wikipedia.org/wiki/Граничное_представление граничного представления (BRep)]. Объект BRep (Boundary Representation) определяется поверхностями, которые ограничивают и определяют внутренний объем. В отличие от сеток, объекты BRep могут иметь широкий спектр компонентов, от плоских граней до очень сложных поверхностей NURBS.
</div>

Модуль Part основан на мощной библиотеке [https://ru.wikipedia.org/wiki/Open_CASCADE_Technology OpenCasCade], обеспечивающей широкий спектр сложных операций над этими объектами, таких как логические операции, филетирование, лофты и т. д.

Модуль Part работает так же, как и модуль Mesh: вы создаете объект FreeCAD, объект Part, а затем добавляете объект Part к объекту FreeCAD:

{{Code|code=
import Part
myshape = Part.makeSphere(10)
myshape.Volume
myshape.Area

shapeobj = doc.addObject("Part::Feature", "MyShape")
shapeobj.Shape = myshape
doc.recompute()
}}

Модуль Part, как и модуль Mesh, имеет ярлык, который автоматически создает объект FreeCAD и добавляет к нему форму, поэтому вы можете сократить последние три строки до:

{{Code|code=
Part.show(myshape)
}}

Исследуя содержимое myshape, вы заметите много интересных подкомпонентов, таких как {{incode|Faces}}, {{incode|Edges}}, {{incode|Vertexes}}, {{incode|Solids}} и {{incode|Shells}}, и широкий спектр геометрических операций, таких как {{incode|cut}} (вычитание), {{incode|common}} (пересечение) или {{incode|fuse}} (объединение). Страница [[Topological_data_scripting/ru|Топологические сценарии данных]] объясняет все это в деталях.

[[Topological_data_scripting/ru|Читать далее про обработку объектов Part в скриптах...]]
{{Top}}
<span id="Draft_module"></span>
<div class="mw-translate-fuzzy">
==Draft==
</div>

<div class="mw-translate-fuzzy">
FreeCAD включает в себя много других модулей, таких как [[Sketcher_Workbench/ru|Sketcher]] и [[Draft_Workbench/ru|Draft]], которые также создают объекты Part. Эти модули добавляют дополнительные параметры к созданным объектам или даже реализуют в них совершенно новый способ обработки геометрии Part. Наш приведенный выше пример куба является идеальным примером параметрического объекта. Все, что вам нужно, чтобы определить куб, это указать параметры высоты, ширины и длины. Исходя из этого, объект автоматически рассчитает свою форму Part. FreeCAD позволяет вам [[Scripted_objects/ru|создавать такие объекты в Python]].
</div>

<div class="mw-translate-fuzzy">
[[Draft_Workbench/ru|Модуль Draft]] добавляет двумерные параметрические типы объектов (которые являются объектами Part), такие как линии и круги, а также предоставляет некоторые общие функции, которые работают не только с объектами Draft, но и с любым объектом Part. Чтобы узнать, что доступно, просто сделайте:
</div>

{{Code|code=
import Draft
rec = Draft.makeRectangle(5, 2)
mvec = FreeCAD.Vector(4, 4, 0)
Draft.move(rec, mvec)
Draft.move(box, mvec)
}}
{{Top}}
<span id="Interface"></span>
==Интерфейс==

Пользовательский интерфейс FreeCAD сделан с помощью [https://ru.wikipedia.org/wiki/Qt Qt], мощной системs графического интерфейса, отвечающей за рисование и обработку всех элементов управления, меню, панелей инструментов и кнопок вокруг окна [[3D_view/ru|трёхмерного просмотра]]. В Qt есть модуль [[PySide/ru|PySide]], через который Python получает доступ к интерфейсам Qt, таким как у FreeCAD. Давайте попробуем поработать с интерфейсом Qt и создать простой диалог:

{{Code|code=
from PySide import QtGui
QtGui.QMessageBox.information(None, "Apollo program", "Houston, we have a problem")
}}

Обратите внимание, что в появившемся диалоговом окне на панели инструментов есть значок FreeCAD, означающий, что Qt знает, что вызов был отдан из приложения FreeCAD. Можно манипулировать любой частью интерфейса FreeCAD.

Qt - это очень мощная система интерфейса, позволяющая делать очень сложные вещи. Она так же имеет несколько простых в использовании инструментов, таких как Qt Designer, с помощью которых вы можете создавать графические диалоги, а затем добавлять их в интерфейс FreeCAD с помощью нескольких строк кода Python.

[[PySide/ru|Больше о PySide здесь...]]
{{Top}}
<span id="Macros"></span>
==Макросы==

Теперь, уже хорошо понимая основы, где мы будем хранить наши скрипты Python и как мы собираемся запускать их внутри FreeCAD? Для этого есть простой механизм, называемый [[Macros/ru|Макросы]]. Макросы - это скрипты Python, которые можно добавлять в панели инструментов и запускать кликом мыши. FreeCAD предоставляет простой текстовый редактор ({{MenuCommand|Макросы → Макрос... → Собрать}}), где вы можете написать или вставить сценарии. Как только скрипт готов, используйте {{MenuCommand|Инструменты → Настройка... → Макрос}} для определения ему кнопки, которую можно добавить на панели инструментов.

==External scripts==

An alternative method for creating, saving, and running your own Python scripts is to create them outside FreeCAD, using an editor of your choice (for example, Vim). To run your Python script inside FreeCAD, be sure to save it with the {{FileName|.py}} extension.

Then use {{MenuCommand|File → Open}} to open your script. It will load into a new tab in the [[Main_view_area|Main view area]]. You can run your script by clicking the {{Button|[[Image:Std_DlgMacroExecuteDirect.svg|16px]] [[Std_DlgMacroExecuteDirect|Execute macro]]}} button. Any errors or script output will be shown in the [[Report_view|Report view]].

When you make and save any modifications to your already-loaded script, a dialog box will appear asking whether you want to reload the modified script into FreeCAD.

<div class="mw-translate-fuzzy">
Теперь вы готовы к более глубокому написанию сценариев FreeCAD. Так что, вперёд в [[Power_users_hub/ru|Центр опытных пользователей]]!
</div>
{{Top}}

{{Docnav/ru
|[[Introduction_to_Python/ru|Introduction to Python]]
|[[FreeCAD_Scripting_Basics/ru|FreeCAD Scripting Basics]]
}}

{{Powerdocnavi{{#translation:}}}}
[[Category:Developer Documentation{{#translation:}}]]
[[Category:Python Code{{#translation:}}]]