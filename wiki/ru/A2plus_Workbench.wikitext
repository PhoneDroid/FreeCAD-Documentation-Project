<languages/>
[[Image:A2p_workbench.svg|thumb|128px|Иконка верстака A2plus]]

<span id="Introduction"></span>
== Введение ==

{{TOCright}}

Верстак A2plus - это [[External workbenches/ru|внешний верстак]] для [[Assembly/ru|создания сборок]] деталей в FreeCAD.

Эта документация описывает версию A2plus '''0.4.56 или новее'''.

<span id="Installing"></span>
==Установка==

Верстак A2plus - это дополнение к FreeCAD. Его легко установить через меню {{MenuCommand | Инструменты → [[Std_AddonMgr | Менеджер дополнений]]}}.
A2plus находится в стадии активной разработки и будет часто получать новые функции. Поэтому вы должны регулярно обновлять его, используя меню {{MenuCommand | Инструменты → [[Std_AddonMgr | Менеджер дополнений]]}}.
Код A2plus размещается и разрабатывается [https://github.com/kbwbe/A2plus на GitHub], а также может быть установлен вручную путем копирования его в каталог MOD FreeCAD.

<span id="Getting_Started"></span>
== Начало работы ==

Сначала переключитесь на панель инструментов A2plus во FreeCAD. Для создания сборки создайте новый файл в FreeCAD. Сначала этот файл нужно сохранить. Рекомендуется (но не обязательно) сохранять его в той же папке, что будущая сборка деталей.

Теперь детали можно добавлять в сборку с помощью кнопки на панели инструментов [[Image: A2p ImportPart.svg|24px]] или [[Image:A2p ShapeReference.svg|24px]]. Кнопка [[Image:A2p ImportPart.svg|24px]] добавляет все тела в выбранном файле как единую деталь. При использовании кнопки [[Image:A2p ShapeReference.svg|24px]] Вы можете выбрать, какие детали из файла должны быть импортированы как деталь. Так можно, например, импортировать только эскиз для сборки дальнейших частей, используя эскиз для определения позиций деталей.

Первая добавленная часть получает фиксированную позицию по умолчанию. (Это можно изменить позже через свойство детали {{PropertyData|фиксированная позиция}}.)

Детали, уже находящиеся в сборке, можно клонировать с помощью кнопки на панели инструментов [[Image: A2p_DuplicatePart.svg|24px]].

Чтобы отредактировать деталь из сборки, выберите ее в дереве модели и используйте кнопку на панели инструментов [[Image:A2p EditPart.svg|24px]]. Это откроет деталь в новой вкладке во FreeCAD или переключится на ее вкладку, если файл уже открыт.

Чтобы импортировать изменения деталей в сборку, нажмите кнопку на панели инструментов [[Image: A2p_ImportPart_Update.svg|24px]]. Кнопка на пранели [[File:A2p_RecursiveUpdate.svg|24px]] тоже импортирует детали, но по возможности рекурсивно [[#Узлы сборки|подсборки]]. Если Вы выберете одну или несколько частей в древе проекта FreeCAD, A2plus запросит Вас об обновлении только выбранных частей.

Импортированные части сохранят свои внешние зависимости и могут быть отредактированы. Однако для стандартных частей, таких как винты, полезно, чтобы их форму нельзя было редактировать. Это может быть достигнуто с помощью кнопки на панели инструментов [[Image: A2p ConvertPart.svg|24px]], которая преобразует выбранную деталь в статическую копию оригинальной детали.

Чтобы сохранить сборку и затем закрыть ее, можно использовать кнопку на панели инструментов [[Image: A2p Save and exit.svg|24px]].

Переключение кнопки панели инструментов [[Image:A2p CD_OneButton.svg|24px]] настраивает способ выделения нескольких рёбер, граней и т. д.: либо одним щелчком, либо {{KEY|Ctrl}}+клик.

<span id="Assembling"></span>
== Сборка ==

Сборка деталей осуществляется путем добавления ограничений между деталями. После введения ограничения A2plus переместит детали в соответствии с ограничением, если это возможно. 

Ограничения между деталями добавляются удерживанием клавиши {{KEY|Ctrl}} и выбором ребра или грани двух частей. Затем нажмите кнопку на панели инструментов нужного ограничения. Появится диалог, определённый в разделе [[#Constraints|Constraints]]. Ограничение будет добавлено в дереве модели к выделенным деталям. 

Для сложных ограничений между частями A2plus может не справится с расположением деталей. Поэтому также ознакомьтесь с разделом [[#Troubleshooting|Устранение неполадок]], чтобы узнать, как решить такие случаи.

<span id="Keeping_track"></span>
=== Отслеживание ===

Чем больше частей вы добавляете, тем важнее сохранять возможность их отслеживания. A2plus предлагает следующие инструменты для перемещения и просмотра деталей:

* Чтобы переместить деталь в сборке, выберите ее в дереве модели и используйте кнопку на панели инструментов [[Image: A2p MovePart.svg|24px]]. Когда вы разместите деталь там, где вам это нравится, щелкните левой кнопкой мыши. Если перемещенная деталь уже имеет ограничения, она будет размещена соответствующим образом при нажатии кнопки на панели инструментов [[Image: A2p solver.svg|24px]], потому что это инициирует разрешение всех ограничений сборки.
* Чтобы отобразить ограничение, выберите его в дереве модели и используйте кнопку на панели инструментов [[Image: A2p ViewConnection.svg|24px]]. Это сделает всю сборку прозрачной и выделит два объекта, связанных ограничениями. Чтобы вернуться к обычному виду, щелкните левой кнопкой мыши по сборке.
* Чтобы показать только определенные детали в сборке, выберите эти детали в дереве модели и используйте кнопку на панели инструментов [[Image: A2p Isolate Element.svg|24px]]. В качестве альтернативы вы можете скрыть определенную деталь, выбрав ее в дереве модели и нажав {{KEY|Space}}, чтобы переключить ее видимость.
* Для переключения вида прозрачности всей сборки вы можете использовать кнопку панели инструментов [[Image: A2p ToggleTransparency.svg|24px]].
* Каждая деталь может быть сделана прозрачной при использовании обычного редактирования FreeCAD. Однако, иногда установки прозрачности деталей пропадают при повторном открытии сборки из-за ошибки в FreeCAD. В качестве обходного пути можно использовать кнопку на панели [[Image:A2p_Restore_Transparency.svg|24px]] для восстановления установок прозрачности.

<span id="Constraints"></span>
=== Ограничения ===

При создании ограничения, после нажатия кнопки на панели инструментов ограничения, будет отображаться такой диалог:

[[Image:A2p_ConstraintPropertiesDialog.png]]
{{Caption|Выше: Диалог параметров ограничений A2plus}}

Для определенных ограничений это позволяет вам изменить направление ограничения. С помощью кнопки {{Button|[[Image:A2p solver.svg|24px]] Solve}} вы можете заранее проверить, может ли это новое ограничение быть решено с помощью A2plus. Если нет, загляните в раздел [[#Разрешение проблем|Разрешение проблем]].

Ограничения могут быть сброшены изменением их [[Std_ToggleVisibility/ru|видимости]]. Это делается выбором ограничения в древе проекта и нажатием {{KEY|Space}}. Это переключает свойство  {{PropertyData|Suppressed}} (подавлено). Подавленное ограничение не учитывается при разрешении сборки.

A2plus поддерживает следующие ограничения:

<span id="Point_on_Point"></span>
==== Точка на точке ====

Выберите [[Glossary#Vertex|Вершины]] (точки) в каждой детали. Кнопка на панели инструментов [[Image: A2p PointIdentity.svg|24px]] добавляет ограничение {{Variable|pointIdentity}}. Это сделает точки совпадающими.

<span id="Point_on_Line"></span>
==== Точка на линии ====

Выберите [[Glossary#Vertex|вершину]] (точку), или [[Glossary#Edge|край]] окружности (выберет ее центр), или [[Glossary#Face|поверхность]] сферы (также выберет ее центр) и [[Glossary # Edge | край]] детали. Кнопка на панели инструментов [[Image: A2p PointOnLineConstraint.svg | 24px]] добавляет ограничение {{Variable|pointOnLine}}. Это поместит точку на край.

<span id="Point_on_Plane"></span>
==== Точка на плоскости ====

Выберите [[Glossary#Vertex|вершину]] (точку), или [[Glossary#Edge|край]] окружности (выберет ее центр), или [[Glossary#Face|поверхность]] сферы (также выберет ее центр) и плоскость. Кнопка на панели инструментов [[Image: A2p PointOnPlaneConstraint.svg|24px]] добавляет ограничение {{Variable|pointOnPlane}}. Диалог ограничений позволяет указать смещение между точкой и плоскостью. Это смещение также можно переключать между обеими сторонами плоскости. Если смещение равно нулю, ограничение поместит вершину на плоскость.

<span id="Sphere_on_Sphere"></span>
==== Сфера на Сфере ====

Выберите [[Glossary#Face|поверхность]] сфер или [[Glossary#Vertex|вершины]] (точки) на обеих деталях. Кнопка на панели инструментов [[Image: A2p SphericalSurfaceConstraint.svg|24px]] добавляет ограничение {{Variable |phereCenterIdent}}. Это совместит центры сфер, центр сферы и точку, либо вершины.

<span id="Circular_Edge_on_Circular_Edge"></span>
==== Круговая кромка на круговой кромке ====

Выберите [[Glossary#Edge|край]] окружности на обеих деталях. Кнопка на панели инструментов [[Image: A2p CircularEdgeConstraint.svg|24px]] добавляет ограничение {{Variable | roundEdge}}. Диалог ограничений позволяет указать смещение между краями. Это смещение также можно перевернуть. Кроме того, вы можете установить направление ограничения и заблокировать вращение частей. Если смещение равно нулю, ограничение поместит края окружности в одной плоскость.

<span id="Axis_Coincident"></span>
==== Совпадение по оси ====

Выберите [[Glossary # Face|поверхность]] сферы или [[Glossary # Edge | края]] линий на обеих частях. Кнопка на панели инструментов [[Image: A2p AxialConstraint.svg|24px]] добавляет ограничение {{Variable|axisCoincident}}. Диалог ограничений позволяет указать направление оси. Диалог позволяет вам также заблокировать вращение частей. Ограничение сделает оси или линии совпадающими.

<span id="Axis_Parallel"></span>
==== Параллельные оси ====

Выберите [[Glossary # Face|поверхность]] сферы или [[Glossary # Edge| края]] линий на обеих частях. Кнопка на панели инструментов [[Image: A2p AxisParallelConstraint.svg | 24px]] добавляет ограничение {{Variable|axisParallel}}. Диалог ограничений позволяет указать направление оси. Ограничение сделает оси или линии параллельными.

<span id="Axis_on_Plane_parallel"></span>
==== Ось параллельно плоскости  ====

Выберите цилиндрическую [[Glossary/ru#Face|поверхность]] или линейные [[Glossary/ru#Edge|края]] детали и плоскость на другой детали. Кнопка на панели инструментов [[Image: A2p AxisPlaneParallelConstraint.svg|24px]] добавляет ограничение {{Variable|axisPlaneParallel}}. Ограничение сделает ось или линию параллельной плоскости.

<span id="Axis_on_Plane_normal"></span>
==== Ось нормально плоскости ====

Выберите цилиндрическую [[Glossary/ru#Face|поверхность]] или линейные [[Glossary/ru#Edge|края]] детали и плоскость на другой детали. Кнопка на панели инструментов [[Image:A2p AxisPlaneNormalConstraint.svg|24px]] добавляет ограничение {{Variable|axisPlaneNormal}}. Ограничение сделает ось или линию нормальной плоскости.

<span id="Axis_on_Plane_angle"></span>
==== Ось под углом к плоскости ====

Выберите цилиндрическую [[Glossary/ru#Face|поверхность]] или линейные [[Glossary/ru#Edge|края]] детали и плоскость на другой детали. Кнопка панели инструментов [[Image:A2p AxisPlaneAngleConstraint.svg|24px]] добавляет ограничение {{Variable|axisPlaneAngle}}. Это ограничение сначала сделает оси параллельными плоскости. Затем вы можете отрегулировать угол для оси в появившемся диалоговом окне настроек ограничения.

<span id="Plane_Parallel"></span>
==== Плоскости Параллельны  ====

Выберите две плоскости. Кнопка на панели инструментов [[Image: A2p PlanesParallelConstraint.svg|24px]] добавляет ограничение {{Variable | planesParallel}}. Диалог ограничений позволяет вам указать направление ограничения. Ограничение сделает плоскости параллельными.

<span id="Plane_on_Plane"></span>
==== Плоскость на Плоскости ====

Выберите две плоскости. Кнопка на панели инструментов [[Image: A2p PlaneCoincidentConstraint.svg|24px]] добавляет ограничение {{Variable | planeCoincident}}. Диалог ограничений позволяет указать направление ограничения и смещение между плоскостями. Это смещение также можно перевернуть. Если смещение равно нулю, ограничение сделает плоскости совпадающими.

<span id="Plane_Angular"></span>
==== Плоскость под углом ====

Выберите две плоскости. Кнопка на панели инструментов [[Image: A2p AngleConstraint.svg|24px]] добавляет ограничение {{Variable | angledPlanes}}. Диалог ограничений позволяет указать угол между плоскостями. Ограничение сначала сделает плоскости параллельными и установит из под заданным углом.

<span id="Coincidence_at_Center_of_Mass"></span>
==== Совпадение в Центре масс ====

Выберите либо две замкнутые области, либо две плоскости. Кнопка на панели инструментов [[Image: A2p CenterOfMassConstraint.svg|24px]] добавляет ограничение {{Variable|centerOfMass}}. Диалог ограничений позволяет указать смещение между краями или плоскостями. Это смещение также можно перевернуть. Кроме того, вы можете установить направление ограничения и заблокировать вращение частей. Если смещение равно нулю, ограничение поместит области или плоскости в одну плоскость.

<span id="Subassemblies"></span>
=== Узлы сборки ===

Сборка может содержать другие сборки. Они добавляются как детали путем нажатия кнопки на панели инструментов [[Image: A2p ImportPart.svg|24px]] и выбора файла {{FileName|* .FCStd}}, содержащего сборку. Такие узлы также можно редактировать как детали, используя кнопку на панели инструментов [[Image: A2p EditPart.svg|24px]]. Убедитесь, что для более высоких этапов сборки вы обновили сборку рекурсивно с помощью кнопки на панели инструментов [[File:A2p_RecursiveUpdate.svg|24px]], когда произошли изменения.

<span id="Constraint_Handling"></span>
== Обработка ограничений ==

Возможные ограничения для выбора отображаются на панели инструментов и в диалоговом окне «Инструменты ограничения» при включении соответствующих кнопок. Диалоговое окно «Инструменты ограничения» открывается с помощью кнопки панели инструментов [[Image: A2p DefineConstraints.svg|24px]]. Он должен оставаться открытым, чтобы можно было быстро добавить несколько ограничений в сборку.

Существующие ограничения можно отредактировать, выбрав их в дереве модели, а затем дважды щелкнув по нему или нажав кнопку на панели инструментов [[Image: A2p EditConstraint.svg|24px]]. Откроется диалоговое окно «Свойства ограничения».

Ограничения могут быть временно отключены выделением их в древе модели и изменением у элемента параметра {{PropertyData|Suppressed}}.

Ограничения можно удалить, выбрав их в дереве модели и нажав {{KEY|Del}}, или выбрав деталь с ограничениями в дереве модели и нажать кнопку на панели инструментов [[Image: A2p DeleteConnections.svg|24px]].

Все ограничения могут быть разрешены в любое время с помощью кнопки на панели инструментов [[Image: A2p solver.svg|24px]]. Если кнопка панели инструментов [[Image: A2p ToggleAutoSolve.svg | 24px]] включена, разрешение выполняется автоматически после каждого редактирования ограничения.

Кнопка на панели инструментов [[Image: A2p FlipConstraint.svg|24px]] влияет на ограничение, которое было недавно добавлено. Это переворачивает направление ограничения.

С помощью инструмента [[Image:A2p CD_ConstraintViewer.svg|24px]] можно показывать и проверять существующие ограничения. После того как вы щёлкнете по нему, появится диалоговое окно. Затем либо выберите деталь в дереве и щёлкните по кнопке {{Button|Import from part (Импорт из детали)}}, чтобы получить все ограничения этой детали, либо выберите одно или несколько ограничений в дереве и нажмите кнопку {{Button|Import from Tree (Импорт из дерева)}}. В результате вы получите всю информацию об ограничениях. Если щёлкнуть в столбце «Подавить», можно подавить одно ограничение. Для получения более подробной информации следуйте подсказкам других кнопок в диалоговом окне.

<span id="Part_Lists"></span>
== Списки деталей ==

Чтобы создать списки деталей сборок, разные детали сборки должны получить информацию о детали, которая может быть прочитана A2plus. Это делается путем редактирования детали с помощью кнопки на панели инструментов [[Image: A2p EditPart.svg|24px]]. В открывшейся части нажмите кнопку панели инструментов [[Image: A2p PartsInfo.svg|24px]] и [[Spreadsheet_Workbench | электронная таблица]] с именем ''#PARTINFO#''.

Структура электронной таблицы выглядит следующим образом:

[[Image:A2p PartinfoTable.png]]

Заполните серые поля имеющейся информацией. Эта информация будет отображена в окончательном списке деталей.

В сборке или узле сборки используйте кнопку на панели инструментов [[Image: A2p PartsList.svg|24px]]. Он спросит вас, хотите ли вы выполнить рекурсивную итерацию по всем узлам сборки. Нажмите «Да». Это создаст новую электронную таблицу с именем ''#PARTSLIST#''. Он содержит информацию из различных электронных таблиц деталей ''PARTSINFO#'' в списке вида:

[[Image:A2p PartslistTable.png]]

Положение (POS) автоматически устанавливается в соответствии с внешним видом деталей в дереве модели. Часть верхнего уровня получит POS 1.

Количество (QTY) автоматически рассчитывается из сборки. Если деталь в сборке дважды, то QTY будет равно 2.

Если вы обновили информацию о детали, вы можете обновить список деталей, снова нажав кнопку на панели инструментов [[Image: A2p PartsList.svg|24px]].

Для сборочных узлов вы также можете создать информационную электронную таблицу с помощью кнопки на панели инструментов [[Image: A2p PartsInfo.svg|24px]]. Когда вы создаете или обновляете список деталей главной сборки, эта информация будет использоваться, если вы ответите «Нет» на вопрос, хотите ли вы рекурсивно выполнять итерации по всем узлам сборки. Тогда разные детали будут находится не в списке деталей, а только в узлах сборки.

<span id="Special_Features"></span>
== Специальные возможности ==

<span id="Assembly_Structure"></span>
=== Структура сборки ===

Кнопка на панели инструментов [[Image: A2p Treeview.svg|24px]] создает файл HTML со структурой вашей сборки. Файл по умолчанию будет создан в текущем каталоге вашей сборки. Структура выглядит следующим образом:

:[[Image:A2p Dependency-Tree.jpg]]

<span id="Degrees_of_Freedom"></span>
=== Степени свободы ===

Кнопка [[Image:A2p DOFs.svg|24px]] помечает каждую часть сборки степенями свободы. Кроме того, он выводит список со всеми деталями и их зависимостями. Список выводится в виджет FreeCAD «Представление отчета». Если этот виджет в настоящее время не отображается, его можно отобразить, щелкнув правой кнопкой мыши пустую часть области панели инструментов FreeCAD и выбрав его в появившемся контекстном меню, или с помощью меню {{MenuCommand|View → Panels  → [[Report view/ru|Просмотр отчета]]}}.

Метки степеней свободы можно удалить, повторно нажав кнопку [[Image:A2p DOFs.svg|24px]].

<span id="Part_Labels"></span>
=== Метки деталей === 

Кнопка [[Image:A2p PartLabel.svg|24px]] присваивает каждой детали сборки в 3D-виде уникальное имя. Метки деталей можно удалить повторно нажав кнопку [[Image:A2p PartLabelRemove.svg|24px]].

<span id="Shape_of_whole_Assembly"></span>
=== Вид всей сборки ===

Иногда необходимо, чтобы вся сборка была объединена в одну фигуру. Эту фигуру можно использовать, например, для 3D-печати в [[Mesh_Workbench/ru|верстаке Mesh]] или для чертежей в [[TechDraw_Workbench/ru|верстаке TechDraw]]. Она создаётся с помощью кнопки на панели инструментов [[Image:A2p_SimpleAssemblyShape.svg|24px]]. По умолчанию фигура не видна. Используйте ту же кнопку панели инструментов для обновления фигуры в случае изменений в сборке.

<span id="Convert_absolute_Paths_to_relative_Ones"></span>
=== Конвертировать абсолютные пути в относительные ===

С помощью меню {{MenuCommand|A2plus → Misc → [[File:A2p_SetRelativePathes.svg|24px]] Convert absolute paths of imported parts to relative ones}} Вы можете конвертировать абсолютные пути импортированных деталей в относительные.

<span id="Preferences"></span>
== Настройки ==

Доступ к настройкам a2plus можно получить через меню FreeCAD {{MenuCommand | Edit → [[Preferences_Editor | Preferences]]}} выбрав раздел «A2plus». Вы можете установить следующие параметры:

<span id="Default_solving_method"></span>
=== Метод решения по умолчанию ===

; Использовать решения частичных систем: Решатель начинает с детали, для которой свойство {{PropertyData|фиксированная позиция}} установлено в значение ''true'', а часть ограничена этим. Все остальные части не рассчитываются. Если решение может быть найдено, добавляется следующая часть ограничений для расчета и так далее.
; Использовать «магнитный» решатель, решая все детали одновременно: Решатель пытается переместить все детали сразу в направлении к детали, у которой свойство {{PropertyData|фиксированная позиция}} установлено в ''true''. Обратите внимание, что в большинстве случаев это займет больше времени для расчета.
; Принудительно фиксировать положение: Для всех деталей в сборке свойство {{PropertyData|фиксированная позиция}} устанавливается в значение ''true''. Тогда никакие расчеты фактически не выполняются, поскольку все детали всегда будут привязаны к позициям, в которых они были созданы.

<span id="Default_solver_behaviour"></span>
=== Поведение решателя по умолчанию ===

; Решить автоматически, если изменён параметр ограничения: Решатель будет запущен автоматически. Аналогично включению кнопки на панели инструментов [[Image: A2p ToggleAutoSolve.svg|24px]].


<span id="Behaviour_when_updating_imported_parts"></span>
=== Поведение при обновлении импортированных деталей ===

; Пересчитать импортированные детали перед их обновлением: Все детали сборки, включая узлы сборок, будут открыты в FreeCAD для реконструкции с использованием значений из электронных таблиц. <br/> Эта функция предназначена для полного параметрирования конструкции. '''Примечание:''' Эта функция очень экспериментальная и не рекомендуется для важных проектов. <br/> Известные проблемы:
* Сборка может быть уничтожена из-за неправильных ссылок на топологические имена в деталях
* Основные электронные таблицы могут быть повреждены, когда они редактируются, а файл детали уже закрыт. Это может привести к краху FreeCAD.

; Включить рекурсивное обновление импортированных деталей: Открывает все узлы сборки рекурсивно для их обновления.

; Использовать экспериментальное топологическое именование: При импорте деталей в сборку алгоритм генерирует топологические имена для каждого узла сборки импортируемой фигуры. Топологические имена записываются в {{PropertyData|mux Info}}. Когда импортируемая деталь должна быть обновлена, эти топологические имена используются для обновления подэлементов ограничений. Таким образом, сборки становятся более устойчивыми к изменчивым числам подэлементов в FreeCAD. <br/> '' 'Примечание:' '' Это увеличивает размеры файлов и время расчета при импорте деталей. Если необходимо использовать топологическое именование, оно должно быть активировано до создания сборки.

; Наследовать прозрачность для каждой поверхности из деталей и узлов: Использовать настройки цвета и прозрачности из импортированных деталей. <br/> '''Примечание:''' Эта функция очень экспериментальная и не рекомендуется для важных проектов.

; Не импортировать невидимые фигуры: Это позволит скрыть невидимые базовые / строительные фигуры. '''Примечание:''' Никакие ограничения не должны быть связаны с опорными / конструктивными формами в вышестоящих или других сборочных узлах. В противном случае вы можете сломать сборку.

; Использовать сплошное объединение для импорта деталей и сборочных узлов: Все импортированные детали будут напрямую объединены в объединение. <br/> Эта функция полезна для моделирования [[FEM_Workbench/ru|FEM (МКЭ)]] или [[Manual:Preparing_models_for_3D_printing/ru|3D-печать]], если разрешено только одно тело. Альтернативой является создание в последствии [[#Shape_of_whole_Assembly|единой формы из всей сборки]].

<span id="User_interface_settings"></span>
=== Настройки интерфейса пользователя ===

; Показать ограничения на панели инструментов: Если эта опция не используется, кнопки панели инструментов для различных ограничений не видны, чтобы сэкономить место на панели инструментов. Новые ограничения по-прежнему можно установить с помощью диалогового окна «Инструменты ограничения» (кнопка на панели инструментов [[Image: A2p DefineConstraints.svg|24px]]).

<span id="Storage_of_files"></span>
=== Хранение файлов ===

; Использовать относительные пути для импортированных деталей: Использует относительные пути к файлам деталей.
; Использовать абсолютные пути для импортированных деталей: Использует абсолютные пути к файлам деталей.
; Все файлы находятся в этой папке проекта: Все файлы проекта должны находиться в указанной папке. Не имеет значения, находятся ли они в подпапках этой папки. '' 'Примечание:' '' Одинаковые  файлы не могут присутствовать несколько раз в папке (например, в разных подпапках). <br/> Эта опция полезна для работы на разных машинах, потому что тогда нужно только скопировать папку проекта.

<span id="Troubleshooting"></span>
== Разрешение проблем ==

Рано или поздно у вас возникнет проблема, что A2plus не может решить установленные вами ограничения. Чтобы преодолеть это, существуют разные стратегии:

<span id="Using_the_Conflict_Finder_Tool"></span>
=== Использование Conflict Finder Tool ===

Conflict Finder Tool (Инструмент Поиска Конфликтов) - Это самый безопасный метод, когда у вас есть несколько ограничений, потому что этот инструмент пытается решить одно ограничение за другим, пока не найдет конфликтующее ограничение. Затем вы можете перейти к другим стратегиям для устранения выявленного ограничения. Инструмент вызывается с помощью кнопки на  панели инструментов [[File:A2p_SearchConstraintConflicts.svg|24px]].

<span id="Checking_Constraint_Direction"></span>
=== Проверка направления ограничения ===

Иногда кажется, что ограничения определены последовательно, но они, тем не менее, не могут быть решены. Пример: Предположим, у вас есть ограничение {{Variable | [[# Plane_Parallel | planesParallel]]}} для двух плоскостей. Теперь вы хотите установить для этих же плоскостей ограничение {{Variable | [[# Plane_on_Plane | planeCoincident]]}}, и A2plus не может решить эту проблему. Тогда направления ограничений {{Variable | planesParallel}} и {{Variable | planeCoincident}} различны. Используйте одно и то же направление для обоих ограничений, чтобы исправить это.

A2plus предлагает автоматическую проверку правильных направлений для '''всех''' ограничений, используя кнопку панели инструментов [[Image:A2p_ReAdjustConstraints.svg|24px]].

<span id="Deleting_Constraints"></span>
=== Удаление ограничений ===

Большинство случаев неразрешимых ограничений происходит непосредственно при добавлении нового ограничения. Решение состоит в том, чтобы удалить ограничение, которое вы добавили последним. A2plus также предложит это.

Иногда стратегия удаления является единственной, например, когда вы отредактировали деталь в FreeCAD так, что грани или ребра, связанные с ограничениями, отсутствуют. Затем следует удалить ограничение по одному, которое связано с измененной деталью. Используйте кнопку на панели инструментов [[Image: A2p solver.svg|24px]] после каждого удаления, чтобы увидеть, достигли ли вы разрешимого состояния.

Когда вы получите сборку, которую можно решить, добавьте шаг за шагом необходимые ограничения.

<span id="Moving_Parts"></span>
=== Перемещение деталей ===

В некоторых случаях решателю нужны только лучшие начальные значения для решения ограничений. Возьмем, к примеру, случай, когда у вас есть осевая часть и колесная часть. Вы добавляете ограничение {{Variable | axisCoincident}} и не получаете информации о том, что решатель не выполнен, но части не перемещаются соответствующим образом, и в виджете «Представление отчета» FreeCAD вы видите "''REACHED POS-ACCURACY: 0.0''". Решением для этого является перемещение деталей ближе к той позиции, которую вы хотите получить с помощью ограничения.

'''Примечание:''' Убедитесь, что хотя бы для одной части ограничения свойство {{PropertyData | фиксированная позиция}} установлено в значение ''false''.

<span id="Setting_the_Tip_Property"></span>
=== Настройка свойства Tip ===

Если вы пропустили некоторые функции своей детали после импорта в сборку A2plus, проверьте свойство {{PropertyData|[[PartDesign_MoveTip|Tip]]}}.

A2plus импортирует тела деталей со всеми их функциями вплоть до свойства Tip. Это разумно, потому что установка Tip на определенную функцию означает, что все функции после Tip не должны появляться в итоговой детали. Так что если Вы пропустили функцию детали в A2plus, откройте деталь через кнопку панели инструментов [[Image:A2p EditPart.svg|24px]], выделите тело и посмотрите свойство {{PropertyData|Tip}}. Если это свойство не в той функции, где нужно, сделайте правый клик на функции, где оно должно быть и выберите {{MenuCommand|[[File:PartDesign_MoveTip.svg|24px]] Set tip}}.Затем сохраните деталь и перезагрузите сборку с помощью кнопки на панели инструментов [[Image:A2p ImportPart_Update.svg|24px]].

<span id="Repairing_Assembly_Tree"></span>
=== Восстановление дерева сборки ===

Если вы не видите четкой причины, по которой некоторые ограничения не могут быть разрешены, вы можете попробовать использовать кнопку на панели инструментов [[Image: A2p RepairTree.svg|24px]]. Это разрешит все ограничения и снова сгруппирует их по разным частям.

<span id="Migrating_old_A2plus_assemblies"></span>
=== Перенос старых сборок A2plus ===

Сборки, созданные с A2plus старше марта 2019 года, не показывают правильные значки для импортированных деталей и имеют устаревшие свойства. Эти сборки можно перенести в A2plus версии 0.4.35 и новее, используя меню {{MenuCommand|A2plus → Misc → [[File:A2p_Upgrade.svg|24px]] Migrate proxies of imported parts}}. Сделав это, вы должны сохранить и снова открыть файл сборки.

<span id="Avoiding_Accented_Characters"></span>
=== Избегайте символов подчеркивания ===

'''Эта стратегия не нужна для Windows.'''

В некоторых операционных системах могут возникнуть проблемы, если имена файлов или пути к файлам деталей или сборки содержат символы с подчеркиванием. Поэтому избегайте таких символов, а также специальных символов в целом.

<span id="Fixing_Position"></span>
=== Фиксированная позиция ===

'''Эта стратегия больше не нужна для сборок, созданных с использованием A2plus 0.3.11 или новее, поскольку A2plus теперь выдает предупреждение о пропущенных фиксированных позициях.'''

Когда вы устанавливаете ограничение между двумя деталями, и ни одна деталь не имеет свойств {{PropertyData | фиксированная позиция}} установленным в ''true'' или связано ограничением с деталью с {{PropertyData | фиксированная позиция}} установленным в ''true'', ограничение не может быть решено. То же самое происходит, если в обеих частях ограничения {{PropertyData | фиксированная позиция}} установлено значение ''true''.

Затем A2plus выводит информацию о неудачном решении, но иногда вы видите только то, что детали не перемещаются соответствующим образом, и в виджете «Представление отчета» FreeCAD вы видите «REACHED POS-ACCURACY: 0.0». Это означает, что решатель завершил работу без ошибок, но на самом деле он не смог решить ограничения.

Поэтому убедитесь, что хотя бы для одной из ваших деталей в сборке {{PropertyData|фиксированная позиция}} установлено значение ''true''. Затем убедитесь, что вы устанавливаете ограничения только для детали, которая каким-то образом связана с фиксированной деталью. Чтобы визуализировать эти зависимости, см. Раздел [[#Assembly_Structure|Структура сборки]].

<span id="Rotating_Parts"></span>
=== Вращение деталей ===

'''Эта стратегия больше не требуется для сборок, созданных с использованием A2plus 0.4.0 или новее, поскольку A2plus автоматически поворачивает детали в фоновом режиме, чтобы получить достаточный начальный угол для решателя.'''

Решатель часто не выполняется для ограничения {{Variable|angledPlanes}}, если две выбранные плоскости в настоящее время имеют угол 0 ° или 180 °. (Части не перемещаются соответственно, и в виджете «Просмотр отчета» FreeCAD вы видите «REACHED POS-ACCURACY: 0.0».) Решение этой проблемы - повернуть одну часть на несколько градусов с помощью FreeCAD функция преобразования (щелкните правой кнопкой мыши деталь в дереве модели и выберите в контекстном меню {{MenuCommand|Transform}}).

'''Примечание:''' Убедитесь, что хотя бы для одной части ограничения свойство {{PropertyData | фиксированная позиция}} установлено в значение ''false''.

<span id="Animation"></span>
== Анимация ==

A2plus предлагает анимацию с помощью перетаскивания и скриптов Python.

<span id="Dragging"></span>
=== Перетаскиванием ===

Анимация перетаскиванием интерактивна, поскольку вы запускаете её, перетаскивая часть сборки.
Чтобы получить этот тип анимации:
# Полностью ограничьте деталь, движение или вращение которой нужно анимировать.
# Нажмите на кнопку панели инструментов [[Image:A2p MovePartUnderConstraints.svg|24px]]. Это включает режим перетаскивания.
# Нажмите на нужную деталь в сборке.
# Теперь вы можете перемещать мышь, и деталь будет следовать за движением мыши в пределах установленных ограничений.
# Чтобы завершить режим перетаскивания, щелкните левой кнопкой мыши в сборке или нажмите ESC.

Вот пример сборки, чтобы попробовать анимацию перетаскиванием: [https://forum.freecadweb.org/download/file.php?id=99204 A2p_example-for-dragging-animation.FCStd]

[[Image:A2p_dragging-animation-result.gif]]

{{Caption|Выше: анимация перетаскивания с использованием примера сборки}}

<span id="Scripting"></span>
=== Скриптами ===

Хотя режим перетаскивания предлагает приятные интерактивные анимации, они порой недостаточно точны для скринкастов или видео. Скриптовые анимации имеют то преимущество, что они анимируют движения и вращения определенным образом. Например, вы можете повернуть деталь ровно на 10° назад и вперед. В следующих примерах используется сборка, в которой деталь должна вращаться. Если вы попытаетесь анимировать это с помощью режима перетаскивания, вы увидите, как трудно получить вращение вперед-назад, чтобы, например, показать своему боссу в презентации. С помощью интерактивного сценарного примера, в то же время, это простая задача.

Скриптовая анимация обычно работает следующим образом:
# Сборку полностью ограничивают
# Сценарий изменяет параметр, например, положение или угол поворота детали.
# После изменения параметра разрешаются ограничения сборки
# Шаг 2. и 3. повторяются, чтобы получить анимацию.

Также можно изменить вместо параметра размещения ограничение, например, расстояние между двумя плоскостями.

<span id="Simple_Script_Example"></span>
==== Пример простого скрипта ====

Самый простой способ написать сценарий анимации - это неинтерактивная анимация, которая следует заданному движению. Вот пример:
Сначала скачайте этот сборочный файл [https://forum.freecadweb.org/download/file.php?id=97554 A2p_animated-example.FCStd] и этот скрипт Python  [https://forum.freecadweb.org/download/file.php?id=97981 A2p_animation-example-script.py].

<div class="mw-collapsible mw-collapsed toccolours">
Вот содержимое скрипта. Строки, начинающиеся с «#», описывают, что делают его разные строки:
<div class="mw-collapsible-content">
{{Code|code=
# импорт библиотек
import time, math, PySide
import A2plus.a2p_solversystem as a2p_solver

# используем шаг в 1 градус
step = 1
# ждём 1 ms между шагами
timeout = 0.001
# начальный угол будет 0 градусов
angle = 0
# берём текущий открытый документ
document = FreeCAD.activeDocument()
# далее мы хотим менять угол вращения детали "star_wheel_001"
starWheel = document.getObject("star_wheel_001")
# определяем диалог хода выполнения от 0 до 360
progressDialog = PySide.QtGui.QProgressDialog(u"Animation progress", u"Stop", 0, 360)

# блок while является основным циклом для изменения угла и 
# разрешения ограничений сборки пошагово
while angle < 360: # запускает цикл пока мы не выполним полный оборот (360 градусов)
    # прибавляем угол вращения
    angle += step
    # устанавливаем новый угол в диалоге хода выполнения
    progressDialog.setValue(angle)
    # изменение угла вращения детали "star_wheel_001"
    starWheel.Placement.Rotation.Angle = math.radians(angle)
    # разрешение ограничений
    a2p_solver.solveConstraints(document, useTransaction=True)
    # обновление вида после разрешения ('Gui' здесь графический интерфейс)
    FreeCADGui.updateGui()
    # вынесение диалога хода выполнения на первый план
    PySide.QtGui.QWidget.raise_(progressDialog)
    # если будет нажата кнопка 'Stop', выйти из цикла
    if progressDialog.wasCanceled():
        angle = 360
    # сделать паузу перед следующим шагом
    time.sleep(timeout)
}}
</div>
</div>

Чтобы использовать скрипт для выполнения анимации, мы должны 
# Открыть файл сборки в FreeCAD. 
# Открыть файл скрипта во FreeCAD.
# Кликнуть кнопку на панели инструментов [[Image:Menu_Std_DlgMacroExecute_fr_02.png|24px]] для запуска скрипта (так же называемого макрос).
# Перейти на вкладку со сборкой для наблюдения за вращением.

Измените что-нибудь в скрипте для практики и запустите снова. Например, измените ''step'' на ''5''.

Вот результат анимации примера:

[[Image:A2p animated-example-result.gif]]

<span id="Interactive_Script_Example"></span>
==== Пример интерактивного скрипта ====

Пример первого скрипта показывает создание анимации без вмешательства пользователя. Для большинства приложений Вам нужно вмешиваться в ход анимации. Например, интересный момент в примере - посмотреть как ведущие штифты пересекают центральную канавку колеса. Для более внимательного просмотра Вам следует представить эту деталь коллегам или начальнику. Поэтому вам нужно интерактивное решение.

Это может быть сделано использованием пользовательского диалога анимации со слайдером. Перемещая слайдер, Вы можете установить угол вращения и вращать вперёд и назад в интересующей позиции.

Мы используем тот же файл сборки [https://forum.freecadweb.org/download/file.php?id=97554 A2p_animated-example.FCStd], и другой скрипт Python [https://forum.freecadweb.org/download/file.php?id=97982 A2p_animation-example-script.py].

<div class="mw-collapsible mw-collapsed toccolours">
Вот содержимое скрипта для получения диалога интерактивной анимации:
<div class="mw-collapsible-content">
{{Code|code=
# импорт библиотек
import time, math, PySide, sys
import FreeCAD.A2plus.a2p_solversystem as a2p_solver
from FreeCAD import Units
from PySide import QtCore, QtGui

# ждать 1 мс после каждого вычисления
timeout = 0.001
# мы берём текущий открытый документ
document = FreeCAD.activeDocument()
# нам нужно впоследствии изменять угол вращения детали "star_wheel_001"
starWheel = document.getObject("star_wheel_001")

class AnimationDlg(QtGui.QWidget): # диалог анимации

    def __init__(self): # для инициализации диалога
        super(AnimationDlg, self).__init__()
        self.initUI()

    def initUI(self): # описание компонентов диалогового окна
        self.setMinimumSize(self.minimumSizeHint()) # установливает минимальный размер диалогового окна на минимум
        self.setWindowTitle('Animation Dialog')
        # используем сеточный макет для всей формы
        self.mainLayout = QtGui.QGridLayout()
        self.lineNo = 0 # первая диалоговая строка в сетке
        # добавить метку описания
        DescriptionLabel = QtGui.QLabel(self)
        DescriptionLabel.setText("Change slider to change rotation angle")
        self.mainLayout.addWidget(DescriptionLabel,self.lineNo,0,1,4)
         # следующая диалоговая строка в сетке
        self.lineNo += 1
        # добавьте метку; нет необходимости в префиксе "self.", потому что мы не хотим менять метку позже
        LabelMin = QtGui.QLabel(self)
        LabelMin.setText("Min")
        LabelMin.setFixedHeight(32)
        self.mainLayout.addWidget(LabelMin,self.lineNo,0)
        # добавляем правку вращения, чтобы определить минимум ползунка
        self.MinEdit = QtGui.QSpinBox(self)
        # получаем единицы измерения угла в виде строки
        self.MinEdit.setSuffix(" " + str(FreeCAD.Units.Quantity(1, FreeCAD.Units.Angle))[2:])
        self.MinEdit.setMaximum(999)
        self.MinEdit.setMinimum(0)
        self.MinEdit.setSingleStep(10)
        self.MinEdit.setValue(0)
        self.MinEdit.setFixedHeight(32)
        self.MinEdit.setToolTip("Minimal angle for the slider")
        QtCore.QObject.connect(self.MinEdit, QtCore.SIGNAL("valueChanged(int)"), self.setMinEdit)
        self.mainLayout.addWidget(self.MinEdit,self.lineNo,1)
        # добавляем ползунок
        self.slider = QtGui.QSlider(QtCore.Qt.Horizontal, self)
        self.slider.setRange(0, 360)
        self.slider.setValue(0)
        self.slider.setFixedHeight(32)
        self.slider.setToolTip("Move the slider to change the rotation angle")
        QtCore.QObject.connect(self.slider, QtCore.SIGNAL("sliderMoved(int)"), self.handleSliderValue)
        self.mainLayout.addWidget(self.slider,self.lineNo,2)
        # добавляем метку
        LabelMax = QtGui.QLabel(self)
        LabelMax.setText("Max")
        LabelMax.setFixedHeight(32)
        self.mainLayout.addWidget(LabelMax,self.lineNo,3)
        # добавляем правку вращения, чтобы определить максимум ползунка
        self.MaxEdit = QtGui.QSpinBox(self)
        # получаем единицы измерения угла в виде строки
        self.MaxEdit.setSuffix(" " + str(FreeCAD.Units.Quantity(1, FreeCAD.Units.Angle))[2:])
        self.MaxEdit.setMaximum(999)
        self.MaxEdit.setMinimum(1)
        self.MaxEdit.setSingleStep(10)
        self.MaxEdit.setValue(360)
        self.MaxEdit.setFixedHeight(32)
        self.MaxEdit.setToolTip("Maximal angle for the slider")
        QtCore.QObject.connect(self.MaxEdit, QtCore.SIGNAL("valueChanged(int)"), self.setMaxEdit)
        self.mainLayout.addWidget(self.MaxEdit,self.lineNo,4)
         # следующая диалоговая строка в сетке
        self.lineNo += 1
        # добовляем spacere
        self.mainLayout.addItem(QtGui.QSpacerItem(10,10), 0, 0)
        # добавляем метку
        LabelCurrent = QtGui.QLabel(self)
        LabelCurrent.setText("Current angle:")
        LabelCurrent.setFixedHeight(32)
        self.mainLayout.addWidget(LabelCurrent,self.lineNo,1)
        # выводим текущий угол
        self.CurrentAngle = QtGui.QLineEdit(self)
        self.CurrentAngle.setText(str(0))
        self.CurrentAngle.setFixedHeight(32)
        self.CurrentAngle.setToolTip("Current rotation angle")
        self.CurrentAngle.isReadOnly()
        self.mainLayout.addWidget(self.CurrentAngle,self.lineNo,2)
        # добавляем метку для единиц измерения
        LabelUnit = QtGui.QLabel(self)
        LabelUnit.setText("deg")
        LabelUnit.setFixedHeight(32)
        self.mainLayout.addWidget(LabelUnit,self.lineNo,3)
        # кнопка для закрытия диалогового окна
        self.Close = QtGui.QPushButton(self)
        self.Close.setText("Close")
        self.Close.setFixedHeight(32)
        self.Close.setToolTip("Closes the dialog")
        QtCore.QObject.connect(self.Close, QtCore.SIGNAL("clicked()"), self.CloseClicked)
        self.mainLayout.addWidget(self.Close,self.lineNo,4)
        # размещаем нашу размеченную сетку в диалоговом окна
        self.setLayout(self.mainLayout)
        self.update()

    def handleSliderValue(self):
        # устанавливаем значение ползунка как угол
        starWheel.Placement.Rotation.Angle = math.radians(self.slider.value())
        # выводим текущий угол
        self.CurrentAngle.setText(str(self.slider.value()))
        # решаем ограничение 
        a2p_solver.solveConstraints(document)
        # обновляем вид после решения  ('Gui' stands for 'graphical user interface')
        FreeCADGui.updateGui()
        # ждём немного, т.к. нужно время для вычислений
        time.sleep(timeout)

    def setMinEdit(self):
        # убеждаемся что минимум меньше максимума
        if self.MinEdit.value() >=  self.MaxEdit.value():
            self.MaxEdit.setValue(self.MinEdit.value() + 1)
        self.slider.setRange(self.MinEdit.value(), self.MaxEdit.value())

    def setMaxEdit(self):
        # убеждаемся что минимум меньше максимума
        if self.MinEdit.value() >=  self.MaxEdit.value():
            self.MinEdit.setValue(self.MaxEdit.value() - 1)
        self.slider.setRange(self.MinEdit.value(), self.MaxEdit.value())

    def CloseClicked(self):
        AnimationDialog.close()

# создать и показать определённый выше диалог
AnimationDialog = AnimationDlg()
AnimationDialog.show()

# запустить цикл когда диалог станет видим
while AnimationDialog.isVisible():
    # обновить вид, важно чтобы дать обратную связь ОС для оживления диалога
    FreeCADGui.updateGui()
    # вынесение диалога вперёд, чтобы он был всегда видим
    QtGui.QWidget.raise_(AnimationDialog)
    # здесь так же выводится выходного ползунка, поскольку во время вычисления слайдер мог быть передвинут
    AnimationDialog.CurrentAngle.setText(str(AnimationDialog.slider.value()))
}}
</div>
</div>

Диалог, определенный в скрипте, выглядит следующим образом:

[[Image:A2p_AnimationDialog.png]]

<span id="Script_Commands"></span>
=== Команды скрипта ===

Чтобы лучше понять синтаксис скрипта, вот некоторая информация о командах:
{{Code|code= starWheel.Placement.Rotation.Angle = math.radians(angle)}} 

Здесь мы меняем свойство размещения {{incode|Rotation.Angle}} детали, которая была преждде взята как  {{incode|starWheel}}. Это свойство даёт угол в [https://ru.wikipedia.org/wiki/Радиан радианах]. Функция {{incode|radians()}} из библиотеки {{incode|math}} преобразует угол из градусов в радианы.

Свойство {{incode|Rotation.Angle}} использует текущее размещение осей детали (в нашем примере ось X). Для вращения детали, например, вокруг оси Z, надо установить ось вращения (перед вызовом команды вращения), используя команду:
{{Code|code= starWheel.Placement.Rotation.Axis = FreeCAD.Vector(0,0,1)}}
Вместо вращения деталь может перемещаться. Чтобы изменить, например, размещение в направлении оси Y оси, команда должна быть: 
{{Code|code= starWheel.Placement.Base.y = PositionShift}}
В этом случае мы должны определять не переменную {{incode|angle}}, а {{incode|PositionShift}}, которую мы меняем каждый проход цикла.

Существуют разные способы установки размещения детали. Некоторые [[Placement/ru|документированы здесь]]. К сожалению, списка со всеми возможными командами размещения не существует (пока).
{{Code|code=a2p_solver.solveConstraints(document, useTransaction=False/True)}} 

Это специфичная для A2plus команда. Она разрешает сборочные ограничения сборки, которую мы ранее получили как {{incode|document}}. Опция {{incode|useTransaction}} указывает, если FreeCAD должен сохранять каждое изменение в стеке отмены/повтора. Поэтому для долгой анимации Вам следует установить её в {{FALSE}}.

{{Userdocnavi{{#translation:}}}}
[[Category:Addons{{#translation:}}]]
[[Category:External Workbenches{{#translation:}}]]